{"version":3,"file":"index.js","sources":["../src/fs.ts","../src/utils.ts","../src/git.ts","../src/package-manager.ts","../src/eslint-config.ts","../src/index.ts"],"sourcesContent":["import { promises as fs } from \"node:fs\";\nimport { join } from \"node:path\";\n\nexport const removeEmptyDirectories = async (dir: string): Promise<void> => {\n  const entries = await fs.readdir(dir, { withFileTypes: true });\n  for (const entry of entries) {\n    const fullPath = join(dir, entry.name);\n    if (entry.isDirectory()) {\n      await removeEmptyDirectories(fullPath);\n    }\n  }\n  // After processing subdirs, check if current dir is empty\n  const remaining = await fs.readdir(dir);\n  if (remaining.length === 0) {\n    await fs.rmdir(dir);\n  }\n};\n","import { exec } from \"node:child_process\";\nimport { readdirSync } from \"node:fs\";\nimport { join } from \"node:path\";\nimport { globifyGitIgnore } from \"globify-gitignore\";\n\nexport const execPromise = (command: string): Promise<void> =>\n  new Promise((resolve, reject) => {\n    exec(command, error => {\n      if (error) {\n        reject(error);\n      } else {\n        resolve();\n      }\n    });\n  });\n\nexport const getIgnorePatterns = async (): Promise<string[]> => {\n  const directory = process.cwd();\n  const entries = await Promise.all(\n    readdirSync(\".\", {\n      encoding: \"utf8\",\n      recursive: false,\n    })\n      .filter((file: string) => /^\\..(\\w+)ignore$/.test(file))\n      .map(async (file: string) => {\n        const entries = await globifyGitIgnore(\n          join(directory, file),\n          directory,\n          true,\n        );\n\n        return entries.filter(e => e.included).map(e => e.glob);\n      }),\n  );\n\n  return entries.flat();\n};\n","import { execPromise } from \"./utils.js\";\n\nexport const gitClean = async (\n  exclude: string[] = [\".env.local\"],\n): Promise<void> => {\n  const excludeArgs = exclude.map(e => `-e ${e}`).join(\" \");\n  const command = `git clean -Xfd ${excludeArgs}`;\n  return execPromise(command);\n};\n","import { execPromise } from \"./utils.js\";\n\nexport const pnpmInstall = async (): Promise<void> => execPromise(\"pnpm i\");\n","import eslint from \"@eslint/js\";\nimport prettierConfig from \"eslint-config-prettier\";\nimport eslintPluginJsonSchemaValidator from \"eslint-plugin-json-schema-validator\";\nimport eslintPluginJsonc from \"eslint-plugin-jsonc\";\nimport prettier from \"eslint-plugin-prettier\";\nimport { type Config } from \"eslint/config\";\nimport tseslint from \"typescript-eslint\";\nimport { getIgnorePatterns } from \"./utils\";\n\nconst tsFiles = [\"**/*.ts\", \"**/*.tsx\"];\n\nexport const getIgnores = async () => ({\n  ignores: [\n    \"dist/\",\n    \"node_modules/\",\n    \"**/*.test.ts\",\n    ...(await getIgnorePatterns()),\n  ],\n});\n\nexport const recommended: Config = eslint.configs.recommended;\n\nexport const jsonc: Config[] =\n  eslintPluginJsonc.configs[\"flat/recommended-with-jsonc\"];\n\nexport const jsonSchema: Config[] =\n  eslintPluginJsonSchemaValidator.configs[\"flat/recommended\"];\n\nexport const prettierConf: Config = prettierConfig;\n\nexport const tsRecommended: Config[] = tseslint.configs.recommended.map(\n  config => ({\n    ...config,\n    files: tsFiles,\n  }),\n);\n\nexport const prettierPlugin: Config = {\n  files: [\"**/*\"],\n  plugins: {\n    prettier,\n  },\n  rules: {\n    \"prettier/prettier\": [\"error\"],\n  },\n};\n\nexport const tsRules: Config = {\n  files: tsFiles,\n  languageOptions: {\n    parser: tseslint.parser,\n    parserOptions: {\n      projectService: {\n        allowDefaultProject: [\"*.ts\"],\n      },\n    },\n  },\n  rules: {\n    \"@typescript-eslint/consistent-type-definitions\": [\"error\", \"type\"],\n    \"@typescript-eslint/no-restricted-imports\": [\n      \"error\",\n      {\n        paths: [\n          {\n            name: \"fs\",\n            message: \"Import from 'node:fs' instead\",\n          },\n          {\n            name: \"path\",\n            message: \"Import from 'node:path' instead\",\n          },\n          {\n            name: \"child_process\",\n            message: \"Import from 'node:child_process' instead\",\n          },\n        ],\n      },\n    ],\n    \"arrow-body-style\": [\"error\", \"as-needed\"],\n    \"func-style\": [\"error\", \"expression\"],\n    \"no-else-return\": \"error\",\n    \"no-restricted-syntax\": [\n      \"error\",\n      {\n        selector: \"SwitchStatement\",\n        message: \"Switch statements are not allowed\",\n      },\n      {\n        selector: \"TSInterfaceDeclaration\",\n        message: \"Use type aliases instead of interfaces\",\n      },\n      {\n        selector: \"ImportNamespaceSpecifier\",\n        message: \"Use explicit imports instead of 'import * as'\",\n      },\n    ],\n  },\n};\n\nexport default async (): Promise<Config[]> => {\n  const ignores = await getIgnores();\n  return [\n    ignores,\n    recommended,\n    ...jsonc,\n    ...jsonSchema,\n    prettierConf,\n    ...tsRecommended,\n    prettierPlugin,\n    tsRules,\n  ];\n};\n","import { removeEmptyDirectories } from \"./fs.js\";\nimport { gitClean } from \"./git.js\";\nimport { pnpmInstall } from \"./package-manager.js\";\nimport { getIgnorePatterns } from \"./utils.js\";\n\nexport const gitCleanCommand = async (): Promise<void> => {\n  await Promise.all([removeEmptyDirectories(\".\"), gitClean()]);\n  await pnpmInstall();\n};\n\nexport { default as prettierConfig } from \"./prettier-config.js\";\nexport { default as eslintConfig } from \"./eslint-config.js\";\nexport { getIgnorePatterns };\n"],"names":["fs","join","exec","readdirSync","entries","globifyGitIgnore","prettierConfig"],"mappings":";;;;;;;;;;;;;AAGO,MAAM,yBAAyB,OAAO,QAA+B;AAC1E,QAAM,UAAU,MAAMA,iBAAG,QAAQ,KAAK,EAAE,eAAe,MAAM;AAC7D,aAAW,SAAS,SAAS;AAC3B,UAAM,WAAWC,UAAAA,KAAK,KAAK,MAAM,IAAI;AACrC,QAAI,MAAM,eAAe;AACvB,YAAM,uBAAuB,QAAQ;AAAA,IACvC;AAAA,EACF;AAEA,QAAM,YAAY,MAAMD,iBAAG,QAAQ,GAAG;AACtC,MAAI,UAAU,WAAW,GAAG;AAC1B,UAAMA,QAAAA,SAAG,MAAM,GAAG;AAAA,EACpB;AACF;ACXO,MAAM,cAAc,CAAC,YAC1B,IAAI,QAAQ,CAAC,SAAS,WAAW;AAC/BE,0BAAK,SAAS,CAAA,UAAS;AACrB,QAAI,OAAO;AACT,aAAO,KAAK;AAAA,IACd,OAAO;AACL,cAAA;AAAA,IACF;AAAA,EACF,CAAC;AACH,CAAC;AAEI,MAAM,oBAAoB,YAA+B;AAC9D,QAAM,YAAY,QAAQ,IAAA;AAC1B,QAAM,UAAU,MAAM,QAAQ;AAAA,IAC5BC,QAAAA,YAAY,KAAK;AAAA,MACf,UAAU;AAAA,MACV,WAAW;AAAA,IAAA,CACZ,EACE,OAAO,CAAC,SAAiB,mBAAmB,KAAK,IAAI,CAAC,EACtD,IAAI,OAAO,SAAiB;AAC3B,YAAMC,WAAU,MAAMC,iBAAAA;AAAAA,QACpBJ,UAAAA,KAAK,WAAW,IAAI;AAAA,QACpB;AAAA,QACA;AAAA,MAAA;AAGF,aAAOG,SAAQ,OAAO,CAAA,MAAK,EAAE,QAAQ,EAAE,IAAI,CAAA,MAAK,EAAE,IAAI;AAAA,IACxD,CAAC;AAAA,EAAA;AAGL,SAAO,QAAQ,KAAA;AACjB;AClCO,MAAM,WAAW,OACtB,UAAoB,CAAC,YAAY,MACf;AAClB,QAAM,cAAc,QAAQ,IAAI,CAAA,MAAK,MAAM,CAAC,EAAE,EAAE,KAAK,GAAG;AACxD,QAAM,UAAU,kBAAkB,WAAW;AAC7C,SAAO,YAAY,OAAO;AAC5B;ACNO,MAAM,cAAc,YAA2B,YAAY,QAAQ;ACO1E,MAAM,UAAU,CAAC,WAAW,UAAU;AAE/B,MAAM,aAAa,aAAa;AAAA,EACrC,SAAS;AAAA,IACP;AAAA,IACA;AAAA,IACA;AAAA,IACA,GAAI,MAAM,kBAAA;AAAA,EAAkB;AAEhC;AAEO,MAAM,cAAsB,OAAO,QAAQ;AAE3C,MAAM,QACX,kBAAkB,QAAQ,6BAA6B;AAElD,MAAM,aACX,gCAAgC,QAAQ,kBAAkB;AAErD,MAAM,eAAuBE;AAE7B,MAAM,gBAA0B,SAAS,QAAQ,YAAY;AAAA,EAClE,CAAA,YAAW;AAAA,IACT,GAAG;AAAA,IACH,OAAO;AAAA,EAAA;AAEX;AAEO,MAAM,iBAAyB;AAAA,EACpC,OAAO,CAAC,MAAM;AAAA,EACd,SAAS;AAAA,IACP;AAAA,EAAA;AAAA,EAEF,OAAO;AAAA,IACL,qBAAqB,CAAC,OAAO;AAAA,EAAA;AAEjC;AAEO,MAAM,UAAkB;AAAA,EAC7B,OAAO;AAAA,EACP,iBAAiB;AAAA,IACf,QAAQ,SAAS;AAAA,IACjB,eAAe;AAAA,MACb,gBAAgB;AAAA,QACd,qBAAqB,CAAC,MAAM;AAAA,MAAA;AAAA,IAC9B;AAAA,EACF;AAAA,EAEF,OAAO;AAAA,IACL,kDAAkD,CAAC,SAAS,MAAM;AAAA,IAClE,4CAA4C;AAAA,MAC1C;AAAA,MACA;AAAA,QACE,OAAO;AAAA,UACL;AAAA,YACE,MAAM;AAAA,YACN,SAAS;AAAA,UAAA;AAAA,UAEX;AAAA,YACE,MAAM;AAAA,YACN,SAAS;AAAA,UAAA;AAAA,UAEX;AAAA,YACE,MAAM;AAAA,YACN,SAAS;AAAA,UAAA;AAAA,QACX;AAAA,MACF;AAAA,IACF;AAAA,IAEF,oBAAoB,CAAC,SAAS,WAAW;AAAA,IACzC,cAAc,CAAC,SAAS,YAAY;AAAA,IACpC,kBAAkB;AAAA,IAClB,wBAAwB;AAAA,MACtB;AAAA,MACA;AAAA,QACE,UAAU;AAAA,QACV,SAAS;AAAA,MAAA;AAAA,MAEX;AAAA,QACE,UAAU;AAAA,QACV,SAAS;AAAA,MAAA;AAAA,MAEX;AAAA,QACE,UAAU;AAAA,QACV,SAAS;AAAA,MAAA;AAAA,IACX;AAAA,EACF;AAEJ;AAEA,MAAA,eAAe,YAA+B;AAC5C,QAAM,UAAU,MAAM,WAAA;AACtB,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA,GAAG;AAAA,IACH,GAAG;AAAA,IACH;AAAA,IACA,GAAG;AAAA,IACH;AAAA,IACA;AAAA,EAAA;AAEJ;AC1GO,MAAM,kBAAkB,YAA2B;AACxD,QAAM,QAAQ,IAAI,CAAC,uBAAuB,GAAG,GAAG,SAAA,CAAU,CAAC;AAC3D,QAAM,YAAA;AACR;;;;;;"}